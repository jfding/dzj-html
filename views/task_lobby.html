<!DOCTYPE html>
{% from controller.task.base import TaskHandler as Th %}
<html lang="zh-CN">
<head>
  <title>任务大厅-{{Th.task_names().get(task_type)}}</title>
  {% include _base_meta.html %}
  {% include _base_css.html %}
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
  <![endif]-->

  <style>
    .lobby-tips {
      font-size: 14px;
      margin-bottom: 20px;
      color: #B8906F;
    }
  </style>
</head>

<body>
<div class="app-main">
  <div class="main">
    <!--公共左侧导航栏 -->
    {% module CommonLeft(title="task-lobby", sub="task-lobby-cut") %}
    <div class="main-content">
      <!--公共头部 -->
      {% module CommonHead() %}
      <div class="single-page-con">
        <div class="layout">
          <div class="layout-content">
            <div class="wrapper">
              <div class="collate-list">
                <div class="lobby-tips fl">总共有 {{total_count}} 条任务</div>
                <div class="search fr">
                  <input id="search-name" type="text" placeholder="搜索">
                  <i class="ser-btn"></i>
                </div>
                <table class="sty-table" style="border-collapse:separate; border-spacing:0px 10px;">
                  <thead>
                  <tr>
                    <th><span>编码</span></th>
                    <th>
                      <div class="btn-group">
                        <span class="sort" data-toggle="dropdown" aria-expanded="false">优先级</span><span class="ion-funnel"></span>
                        <ul class="dropdown-menu" role="menu">
                          <li><a href="#" val="3">高</a></li>
                          <li><a href="#" val="2">中</a></li>
                          <li><a href="#" val="1">低</a></li>
                        </ul>
                      </div>
                    </th>
                    <th><span>操作</span></th>
                  </tr>
                  </thead>
                  <tbody>
                  {% for t in tasks %}
                  <tr>
                    <td>{{t['doc_id']}}</td>
                    <td>{{Th.get_priority_name(t['priority']) or ''}}</td>
                    <td><a class="pick-task" id="{{t['_id']}}" href="/task/pick/{{t['task_type']}}" style="cursor:pointer">领取</a></td>
                  </tr>
                  {% end %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% include _base_js.html %}
<script src="{{ static_url('js/pick-task.js') }}"></script>
<script>
  // 搜索
  $('#search-name').on("keydown", function (event) {
    var keyCode = event.keyCode || event.which;
    if (keyCode === 13) {
      var q = $(this).val().trim();
      window.location = q === '' ? "{{current_path}}" : "{{current_path}}?q=" + q;
    }
  });

  // 领任务
  $('.pick-task').on("click", function (e) {
    e.preventDefault();
    pick($(this).attr('href'), $(this).attr('id'));
  });

</script>


</body>
</html>