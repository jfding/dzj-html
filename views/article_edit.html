<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <title>{{'新建文章' if len(article_id) < 9 else '文章编辑'}}</title>
  {% include _base_meta.html %}
  {% include _base_css.html %}
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
  <![endif]-->
</head>

<style>
  .content {
    margin: 60px 20px 10px;
  }
</style>

<body>
<div class="app-main">
  <div class="main">
    <header class="m-header">
      <div class="back">
        <a href="/">
          <img src="{{ static_url('imgs/home.png') }}" class="btn-img"/>
        </a>
      </div>
      <div class="title">{{'新建文章' if len(article_id) < 9 else '文章编辑'}}</div>
      <input type="text" id="title" class="form-control" placeholder="文章标题"
             style="display: inline-block; width: calc(100% - 220px); margin: 3px 0 0 15px;" value="{{article.get('title') or ''}}">
      <div class="right" style="margin: 2px 8px">
      </div>
    </header>
    <div class="content">
      <div>
        <script class="editor" id="editor1" type="text/plain" style="width: 100%;max-width: 800px;min-height: 100px;"></script>
      </div>
      <div style="margin-top: 10px">
        <div class="input-group">
          <span class="input-group-addon" id="basic-addon1">文章分类</span>
          <input type="text" id="category" class="form-control" value="{{article.get('category') or ''}}"
              placeholder="文章分类" aria-describedby="basic-addon1">
        </div>
        <div class="text-right" style="margin-top: 10px">
          <button type="button" class="btn btn-default" id="btn-preview">预览</button>
          <button type="button" class="btn btn-primary" id="btn-submit">保存</button>
        </div>
      </div>
    </div>

  </div>
</div>

{% include _base_js.html %}

<!-- UM Editor -->
<link href="{{ static_url('editor/themes/default/_css/umeditor.css') }}" rel="stylesheet" type="text/css" />
<script src="{{ static_url('editor/third-party/template.min.js') }}"></script>
<script src="{{ static_url('editor/editor.config.js') }}"></script>
<script src="{{ static_url('editor/editor.api.js') }}"></script>
<script src="{{ static_url('editor/lang/zh-cn/zh-cn.js') }}"></script>
<script src="{{ static_url('js/editor.js') }}"></script>

<!-- CUSTOM JS -->
<script>
  var id = '{{article_id}}';
  var $preview = $('#btn-preview');
  initEditor('editor1', decodeJSON('{{article.get("content") or ""}}', true));
  $('#btn-submit').on('click', function () {
    var content = UM.getEditor('editor1').getContent();
    postApi('/article/save/' + id,
        {data: {title: $('#title').val(), category: $('#category').val(), content: content}},
        function (data) {
          id = data.id;
          $preview.show();
          showSuccess(data.modified === 0 ? '没有改变' : '保存成功')
        });
  });
  $preview.toggle(id.length > 10);
  $preview.click(function () {
    if (id.length > 10) {
      window.location = '/article/' + id;
    }
  });
</script>

</body>
</html>
